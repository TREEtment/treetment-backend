networks:
  appnet:
    external: true

services:
  backend:
    image: ghcr.io/${GITHUB_REPOSITORY}/backend-backend:${GIT_SHA}
    container_name: backend
    restart: always
    ports:
      - "80:8080"
    environment:
      JASYPT_ENCRYPTOR_PASSWORD: ${JASYPT_ENCRYPTOR_PASSWORD}
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
      TZ: ${TZ:-Asia/Seoul}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      AWS_DEFAULT_REGION: ${AWS_DEFAULT_REGION:-ap-northeast-2}
      INTERNAL_SECRET: ${INTERNAL_SECRET}
      AI_IMAGE_URL: http://host.docker.internal:8100
      AI_TEXT_URL:  http://host.docker.internal:8000

      # ðŸ”´ ì—¬ê¸°ê°€ í•µì‹¬: ì‹œìŠ¤í…œ í”„ë¡œí¼í‹°ë¡œ ai.* ì£¼ì†Œë¥¼ 'ê°•ì œ'
      JAVA_OPTS: >-
        -Dsun.net.inetaddr.ttl=30
        -Dsun.net.inetaddr.negative.ttl=0
        -Dai.image.url=http://host.docker.internal:8100
        -Dai.text.url=http://host.docker.internal:8000

    extra_hosts:
      - "host.docker.internal:host-gateway"

    networks:
      - appnet
